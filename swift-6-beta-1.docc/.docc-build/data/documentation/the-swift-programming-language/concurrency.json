{"primaryContentSections":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Swift has built-in support for writing asynchronous and parallel code","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"in a structured way."},{"type":"text","text":" "},{"type":"emphasis","inlineContent":[{"type":"text","text":"Asynchronous code"}]},{"type":"text","text":" can be suspended and resumed later,"},{"type":"text","text":" "},{"type":"text","text":"although only one piece of the program executes at a time."},{"text":" ","type":"text"},{"text":"Suspending and resuming code in your program","type":"text"},{"type":"text","text":" "},{"type":"text","text":"lets it continue to make progress"},{"type":"text","text":" "},{"type":"text","text":"on short-term operations like updating its UI"},{"text":" ","type":"text"},{"type":"text","text":"while continuing to work on long-running operations"},{"text":" ","type":"text"},{"type":"text","text":"like fetching data over the network or parsing files."},{"type":"text","text":" "},{"type":"emphasis","inlineContent":[{"type":"text","text":"Parallel code"}]},{"type":"text","text":" means multiple pieces of code run simultaneously —"},{"type":"text","text":" "},{"type":"text","text":"for example, a computer with a four-core processor"},{"type":"text","text":" "},{"type":"text","text":"can run four pieces of code at the same time,"},{"type":"text","text":" "},{"text":"with each core carrying out one of the tasks.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"A program that uses parallel and asynchronous code"},{"text":" ","type":"text"},{"type":"text","text":"carries out multiple operations at a time,"},{"text":" ","type":"text"},{"text":"and it suspends operations that are waiting for an external system.","type":"text"}]},{"inlineContent":[{"text":"The additional scheduling flexibility from parallel or asynchronous code","type":"text"},{"type":"text","text":" "},{"type":"text","text":"also comes with a cost of increased complexity."},{"type":"text","text":" "},{"type":"text","text":"Swift lets you express your intent"},{"type":"text","text":" "},{"type":"text","text":"in a way that enables some compile-time checking —"},{"type":"text","text":" "},{"type":"text","text":"for example, you can use actors to safely access mutable state."},{"type":"text","text":" "},{"type":"text","text":"However, adding concurrency to slow or buggy code"},{"text":" ","type":"text"},{"type":"text","text":"isn’t a guarantee that it will become fast or correct."},{"type":"text","text":" "},{"type":"text","text":"In fact, adding concurrency might even make your code harder to debug."},{"text":" ","type":"text"},{"text":"However, using Swift’s language-level support for concurrency","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"in code that needs to be concurrent"},{"text":" ","type":"text"},{"text":"means Swift can help you catch problems at compile time.","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"The rest of this chapter uses the term ","type":"text"},{"type":"emphasis","inlineContent":[{"type":"text","text":"concurrency"}]},{"type":"text","text":" "},{"type":"text","text":"to refer to this common combination of asynchronous and parallel code."}]},{"name":"Note","type":"aside","style":"note","content":[{"type":"paragraph","inlineContent":[{"text":"If you’ve written concurrent code before,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"you might be used to working with threads."},{"text":" ","type":"text"},{"type":"text","text":"The concurrency model in Swift is built on top of threads,"},{"type":"text","text":" "},{"text":"but you don’t interact with them directly.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"An asynchronous function in Swift"},{"text":" ","type":"text"},{"text":"can give up the thread that it’s running on,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"which lets another asynchronous function run on that thread"},{"type":"text","text":" "},{"text":"while the first function is blocked.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"When an asynchronous function resumes,"},{"text":" ","type":"text"},{"type":"text","text":"Swift doesn’t make any guarantee about which thread"},{"text":" ","type":"text"},{"text":"that function will run on.","type":"text"}]}]},{"inlineContent":[{"text":"Although it’s possible to write concurrent code","type":"text"},{"type":"text","text":" "},{"type":"text","text":"without using Swift’s language support,"},{"type":"text","text":" "},{"text":"that code tends to be harder to read.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"For example, the following code downloads a list of photo names,"},{"text":" ","type":"text"},{"type":"text","text":"downloads the first photo in that list,"},{"text":" ","type":"text"},{"type":"text","text":"and shows that photo to the user:"}],"type":"paragraph"},{"type":"codeListing","code":["listPhotos(inGallery: \"Summer Vacation\") { photoNames in","    let sortedNames = photoNames.sorted()","    let name = sortedNames[0]","    downloadPhoto(named: name) { photo in","        show(photo)","    }","}"],"syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Even in this simple case,"},{"type":"text","text":" "},{"text":"because the code has to be written as a series of completion handlers,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"you end up writing nested closures."},{"type":"text","text":" "},{"text":"In this style,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"more complex code with deep nesting can quickly become unwieldy."}]},{"anchor":"Defining-and-Calling-Asynchronous-Functions","level":2,"type":"heading","text":"Defining and Calling Asynchronous Functions"},{"type":"paragraph","inlineContent":[{"type":"text","text":"An "},{"type":"emphasis","inlineContent":[{"text":"asynchronous function","type":"text"}]},{"text":" or ","type":"text"},{"type":"emphasis","inlineContent":[{"text":"asynchronous method","type":"text"}]},{"text":" ","type":"text"},{"type":"text","text":"is a special kind of function or method"},{"text":" ","type":"text"},{"type":"text","text":"that can be suspended while it’s partway through execution."},{"type":"text","text":" "},{"text":"This is in contrast to ordinary, synchronous functions and methods,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"which either run to completion, throw an error, or never return."},{"text":" ","type":"text"},{"type":"text","text":"An asynchronous function or method still does one of those three things,"},{"text":" ","type":"text"},{"type":"text","text":"but it can also pause in the middle when it’s waiting for something."},{"text":" ","type":"text"},{"type":"text","text":"Inside the body of an asynchronous function or method,"},{"type":"text","text":" "},{"text":"you mark each of these places where execution can be suspended.","type":"text"}]},{"inlineContent":[{"type":"text","text":"To indicate that a function or method is asynchronous,"},{"type":"text","text":" "},{"type":"text","text":"you write the "},{"code":"async","type":"codeVoice"},{"text":" keyword in its declaration after its parameters,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"similar to how you use "},{"type":"codeVoice","code":"throws"},{"type":"text","text":" to mark a throwing function."},{"type":"text","text":" "},{"text":"If the function or method returns a value,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"you write "},{"code":"async","type":"codeVoice"},{"type":"text","text":" before the return arrow ("},{"type":"codeVoice","code":"->"},{"type":"text","text":")."},{"text":" ","type":"text"},{"type":"text","text":"For example,"},{"text":" ","type":"text"},{"type":"text","text":"here’s how you might fetch the names of photos in a gallery:"}],"type":"paragraph"},{"code":["func listPhotos(inGallery name: String) async -> [String] {","    let result = \/\/ ... some asynchronous networking code ...","    return result","}"],"syntax":"swift","type":"codeListing"},{"inlineContent":[{"type":"text","text":"For a function or method that’s both asynchronous and throwing,"},{"type":"text","text":" "},{"text":"you write ","type":"text"},{"code":"async","type":"codeVoice"},{"type":"text","text":" before "},{"type":"codeVoice","code":"throws"},{"type":"text","text":"."}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"When calling an asynchronous method,"},{"type":"text","text":" "},{"type":"text","text":"execution suspends until that method returns."},{"text":" ","type":"text"},{"text":"You write ","type":"text"},{"type":"codeVoice","code":"await"},{"text":" in front of the call","type":"text"},{"type":"text","text":" "},{"text":"to mark the possible suspension point.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"This is like writing "},{"type":"codeVoice","code":"try"},{"type":"text","text":" when calling a throwing function,"},{"type":"text","text":" "},{"type":"text","text":"to mark the possible change to the program’s flow if there’s an error."},{"type":"text","text":" "},{"text":"Inside an asynchronous method,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"the flow of execution is suspended "},{"inlineContent":[{"type":"text","text":"only"}],"type":"emphasis"},{"type":"text","text":" when you call another asynchronous method —"},{"type":"text","text":" "},{"text":"suspension is never implicit or preemptive —","type":"text"},{"type":"text","text":" "},{"text":"which means every possible suspension point is marked with ","type":"text"},{"type":"codeVoice","code":"await"},{"type":"text","text":"."},{"type":"text","text":" "},{"type":"text","text":"Marking all of the possible suspension points in your code"},{"type":"text","text":" "},{"text":"helps make concurrent code easier to read and understand.","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"For example,"},{"type":"text","text":" "},{"type":"text","text":"the code below fetches the names of all the pictures in a gallery"},{"type":"text","text":" "},{"text":"and then shows the first picture:","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["let photoNames = await listPhotos(inGallery: \"Summer Vacation\")","let sortedNames = photoNames.sorted()","let name = sortedNames[0]","let photo = await downloadPhoto(named: name)","show(photo)"]},{"inlineContent":[{"type":"text","text":"Because the "},{"type":"codeVoice","code":"listPhotos(inGallery:)"},{"type":"text","text":" and "},{"type":"codeVoice","code":"downloadPhoto(named:)"},{"text":" functions","type":"text"},{"type":"text","text":" "},{"text":"both need to make network requests,","type":"text"},{"type":"text","text":" "},{"text":"they could take a relatively long time to complete.","type":"text"},{"text":" ","type":"text"},{"text":"Making them both asynchronous by writing ","type":"text"},{"code":"async","type":"codeVoice"},{"text":" before the return arrow","type":"text"},{"type":"text","text":" "},{"type":"text","text":"lets the rest of the app’s code keep running"},{"type":"text","text":" "},{"type":"text","text":"while this code waits for the picture to be ready."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"To understand the concurrent nature of the example above,","type":"text"},{"type":"text","text":" "},{"text":"here’s one possible order of execution:","type":"text"}]},{"type":"orderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"The code starts running from the first line","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"and runs up to the first "},{"type":"codeVoice","code":"await"},{"text":".","type":"text"},{"type":"text","text":" "},{"text":"It calls the ","type":"text"},{"code":"listPhotos(inGallery:)","type":"codeVoice"},{"text":" function","type":"text"},{"type":"text","text":" "},{"type":"text","text":"and suspends execution while it waits for that function to return."}]}]},{"content":[{"inlineContent":[{"type":"text","text":"While this code’s execution is suspended,"},{"type":"text","text":" "},{"type":"text","text":"some other concurrent code in the same program runs."},{"type":"text","text":" "},{"type":"text","text":"For example, maybe a long-running background task"},{"type":"text","text":" "},{"text":"continues updating a list of new photo galleries.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"That code also runs until the next suspension point, marked by "},{"type":"codeVoice","code":"await"},{"type":"text","text":","},{"type":"text","text":" "},{"type":"text","text":"or until it completes."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"After "},{"type":"codeVoice","code":"listPhotos(inGallery:)"},{"text":" returns,","type":"text"},{"type":"text","text":" "},{"text":"this code continues execution starting at that point.","type":"text"},{"text":" ","type":"text"},{"text":"It assigns the value that was returned to ","type":"text"},{"type":"codeVoice","code":"photoNames"},{"text":".","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"The lines that define ","type":"text"},{"type":"codeVoice","code":"sortedNames"},{"type":"text","text":" and "},{"code":"name","type":"codeVoice"},{"type":"text","text":" "},{"type":"text","text":"are regular, synchronous code."},{"text":" ","type":"text"},{"text":"Because nothing is marked ","type":"text"},{"type":"codeVoice","code":"await"},{"text":" on these lines,","type":"text"},{"text":" ","type":"text"},{"text":"there aren’t any possible suspension points.","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"The next ","type":"text"},{"code":"await","type":"codeVoice"},{"text":" marks the call to the ","type":"text"},{"code":"downloadPhoto(named:)","type":"codeVoice"},{"type":"text","text":" function."},{"type":"text","text":" "},{"type":"text","text":"This code pauses execution again until that function returns,"},{"type":"text","text":" "},{"type":"text","text":"giving other concurrent code an opportunity to run."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"After "},{"code":"downloadPhoto(named:)","type":"codeVoice"},{"text":" returns,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"its return value is assigned to "},{"type":"codeVoice","code":"photo"},{"type":"text","text":" "},{"type":"text","text":"and then passed as an argument when calling "},{"type":"codeVoice","code":"show(_:)"},{"text":".","type":"text"}]}]}]},{"type":"paragraph","inlineContent":[{"text":"The possible suspension points in your code marked with ","type":"text"},{"type":"codeVoice","code":"await"},{"text":" ","type":"text"},{"type":"text","text":"indicate that the current piece of code might pause execution"},{"text":" ","type":"text"},{"text":"while waiting for the asynchronous function or method to return.","type":"text"},{"text":" ","type":"text"},{"text":"This is also called ","type":"text"},{"type":"emphasis","inlineContent":[{"type":"text","text":"yielding the thread"}]},{"type":"text","text":" "},{"type":"text","text":"because, behind the scenes,"},{"type":"text","text":" "},{"type":"text","text":"Swift suspends the execution of your code on the current thread"},{"text":" ","type":"text"},{"type":"text","text":"and runs some other code on that thread instead."},{"type":"text","text":" "},{"type":"text","text":"Because code with "},{"code":"await","type":"codeVoice"},{"text":" needs to be able to suspend execution,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"only certain places in your program can call asynchronous functions or methods:"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Code in the body of an asynchronous function, method, or property.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Code in the static ","type":"text"},{"type":"codeVoice","code":"main()"},{"type":"text","text":" method of"},{"type":"text","text":" "},{"type":"text","text":"a structure, class, or enumeration that’s marked with "},{"type":"codeVoice","code":"@main"},{"type":"text","text":"."}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Code in an unstructured child task,"},{"text":" ","type":"text"},{"type":"text","text":"as shown in "},{"identifier":"doc:\/\/org.swift.tspl\/documentation\/The-Swift-Programming-Language\/Concurrency#Unstructured-Concurrency","type":"reference","isActive":true},{"type":"text","text":" below."}],"type":"paragraph"}]}]},{"inlineContent":[{"type":"text","text":"You can explicitly insert a suspension point"},{"type":"text","text":" "},{"type":"text","text":"by calling the "},{"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3814840-yield","type":"reference","isActive":true},{"type":"text","text":" method."}],"type":"paragraph"},{"syntax":"swift","code":["func generateSlideshow(forGallery gallery: String) async {","    let photos = await listPhotos(inGallery: gallery)","    for photo in photos {","        \/\/ ... render a few seconds of video for this photo ...","        await Task.yield()","    }","}"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"Assuming the code that renders video is synchronous,"},{"type":"text","text":" "},{"type":"text","text":"it doesn’t contain any suspension points."},{"type":"text","text":" "},{"type":"text","text":"The work to render video could also take a long time."},{"type":"text","text":" "},{"type":"text","text":"However,"},{"type":"text","text":" "},{"text":"you can periodically call ","type":"text"},{"type":"codeVoice","code":"Task.yield()"},{"type":"text","text":" "},{"text":"to explicitly add suspension points.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"Structuring long-running code this way"},{"type":"text","text":" "},{"type":"text","text":"lets Swift balance between making progress on this task,"},{"type":"text","text":" "},{"text":"and letting other tasks in your program make progress on their work.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"The "},{"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/sleep(for:tolerance:clock:)","isActive":true,"type":"reference"},{"text":" method","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"is useful when writing simple code"},{"text":" ","type":"text"},{"text":"to learn how concurrency works.","type":"text"},{"text":" ","type":"text"},{"text":"This method suspends the current task for at least the given amount of time.","type":"text"},{"type":"text","text":" "},{"text":"Here’s a version of the ","type":"text"},{"code":"listPhotos(inGallery:)","type":"codeVoice"},{"text":" function","type":"text"},{"type":"text","text":" "},{"type":"text","text":"that uses "},{"code":"sleep(for:tolerance:clock:)","type":"codeVoice"},{"type":"text","text":" to simulate waiting for a network operation:"}],"type":"paragraph"},{"code":["func listPhotos(inGallery name: String) async throws -> [String] {","    try await Task.sleep(for: .seconds(2))","    return [\"IMG001\", \"IMG99\", \"IMG0404\"]","}"],"syntax":"swift","type":"codeListing"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The version of "},{"type":"codeVoice","code":"listPhotos(inGallery:)"},{"type":"text","text":" in the code above"},{"type":"text","text":" "},{"type":"text","text":"is both asynchronous and throwing,"},{"text":" ","type":"text"},{"text":"because the call to ","type":"text"},{"type":"codeVoice","code":"Task.sleep(until:tolerance:clock:)"},{"type":"text","text":" can throw an error."},{"type":"text","text":" "},{"text":"When you call this version of ","type":"text"},{"code":"listPhotos(inGallery:)","type":"codeVoice"},{"text":",","type":"text"},{"text":" ","type":"text"},{"text":"you write both ","type":"text"},{"code":"try","type":"codeVoice"},{"text":" and ","type":"text"},{"type":"codeVoice","code":"await"},{"type":"text","text":":"}]},{"type":"codeListing","syntax":"swift","code":["let photos = try await listPhotos(inGallery: \"A Rainy Weekend\")"]},{"inlineContent":[{"text":"Asynchronous functions have some similarities to throwing functions:","type":"text"},{"type":"text","text":" "},{"type":"text","text":"When you define an asynchronous or throwing function,"},{"type":"text","text":" "},{"type":"text","text":"you mark it with "},{"code":"async","type":"codeVoice"},{"text":" or ","type":"text"},{"code":"throws","type":"codeVoice"},{"type":"text","text":","},{"text":" ","type":"text"},{"text":"and you mark calls to that function with ","type":"text"},{"type":"codeVoice","code":"await"},{"type":"text","text":" or "},{"type":"codeVoice","code":"try"},{"text":".","type":"text"},{"type":"text","text":" "},{"text":"An asynchronous function can call another asynchronous function,","type":"text"},{"type":"text","text":" "},{"text":"just like a throwing function can call another throwing function.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"However, there’s a very important difference.","type":"text"},{"type":"text","text":" "},{"text":"You can wrap throwing code in a ","type":"text"},{"type":"codeVoice","code":"do"},{"text":"-","type":"text"},{"code":"catch","type":"codeVoice"},{"type":"text","text":" block to handle errors,"},{"type":"text","text":" "},{"text":"or use ","type":"text"},{"type":"codeVoice","code":"Result"},{"text":" to store the error for code elsewhere to handle it.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"These approaches let you call throwing functions"},{"text":" ","type":"text"},{"type":"text","text":"from nonthrowing code."},{"text":" ","type":"text"},{"type":"text","text":"For example:"}],"type":"paragraph"},{"code":["func availableRainyWeekendPhotos() -> Result<[String], Error> {","    return Result {","        try listDownloadedPhotos(inGallery: \"A Rainy Weekend\")","    }","}"],"type":"codeListing","syntax":"swift"},{"inlineContent":[{"text":"In contrast,","type":"text"},{"type":"text","text":" "},{"text":"there’s no safe way to wrap asynchronous code","type":"text"},{"type":"text","text":" "},{"text":"so you can call it from synchronous code and wait for the result.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"The Swift standard library intentionally omits this unsafe functionality —"},{"type":"text","text":" "},{"type":"text","text":"trying to implement it yourself can lead to"},{"text":" ","type":"text"},{"type":"text","text":"problems like subtle races, threading issues, and deadlocks."},{"text":" ","type":"text"},{"text":"When adding concurrent code to an existing project,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"work from the top down."},{"text":" ","type":"text"},{"type":"text","text":"Specifically,"},{"text":" ","type":"text"},{"text":"start by converting the top-most layer of code to use concurrency,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"and then start converting the functions and methods that it calls,"},{"text":" ","type":"text"},{"text":"working through the project’s architecture one layer at a time.","type":"text"},{"type":"text","text":" "},{"text":"There’s no way to take a bottom-up approach,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"because synchronous code can’t ever call asynchronous code."}],"type":"paragraph"},{"type":"heading","level":2,"anchor":"Asynchronous-Sequences","text":"Asynchronous Sequences"},{"inlineContent":[{"text":"The ","type":"text"},{"type":"codeVoice","code":"listPhotos(inGallery:)"},{"text":" function in the previous section","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"asynchronously returns the whole array at once,"},{"type":"text","text":" "},{"text":"after all of the array’s elements are ready.","type":"text"},{"type":"text","text":" "},{"text":"Another approach","type":"text"},{"type":"text","text":" "},{"type":"text","text":"is to wait for one element of the collection at a time"},{"type":"text","text":" "},{"text":"using an ","type":"text"},{"inlineContent":[{"type":"text","text":"asynchronous sequence"}],"type":"emphasis"},{"text":".","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"Here’s what iterating over an asynchronous sequence looks like:"}],"type":"paragraph"},{"code":["import Foundation","","let handle = FileHandle.standardInput","for try await line in handle.bytes.lines {","    print(line)","}"],"type":"codeListing","syntax":"swift"},{"type":"paragraph","inlineContent":[{"text":"Instead of using an ordinary ","type":"text"},{"code":"for","type":"codeVoice"},{"type":"text","text":"-"},{"code":"in","type":"codeVoice"},{"text":" loop,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"the example above writes "},{"code":"for","type":"codeVoice"},{"text":" with ","type":"text"},{"code":"await","type":"codeVoice"},{"text":" after it.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"Like when you call an asynchronous function or method,"},{"text":" ","type":"text"},{"type":"text","text":"writing "},{"type":"codeVoice","code":"await"},{"type":"text","text":" indicates a possible suspension point."},{"text":" ","type":"text"},{"text":"A ","type":"text"},{"code":"for","type":"codeVoice"},{"type":"text","text":"-"},{"code":"await","type":"codeVoice"},{"type":"text","text":"-"},{"type":"codeVoice","code":"in"},{"text":" loop potentially suspends execution","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"at the beginning of each iteration,"},{"type":"text","text":" "},{"text":"when it’s waiting for the next element to be available.","type":"text"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"In the same way that you can use your own types in a "},{"type":"codeVoice","code":"for"},{"type":"text","text":"-"},{"type":"codeVoice","code":"in"},{"text":" loop","type":"text"},{"text":" ","type":"text"},{"text":"by adding conformance to the ","type":"text"},{"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/swift\/sequence","isActive":true},{"text":" protocol,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"you can use your own types in a "},{"code":"for","type":"codeVoice"},{"text":"-","type":"text"},{"type":"codeVoice","code":"await"},{"text":"-","type":"text"},{"code":"in","type":"codeVoice"},{"text":" loop","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"by adding conformance to the "},{"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/swift\/asyncsequence","isActive":true},{"type":"text","text":" protocol."}]},{"type":"heading","level":2,"text":"Calling Asynchronous Functions in Parallel","anchor":"Calling-Asynchronous-Functions-in-Parallel"},{"type":"paragraph","inlineContent":[{"text":"Calling an asynchronous function with ","type":"text"},{"type":"codeVoice","code":"await"},{"text":" ","type":"text"},{"text":"runs only one piece of code at a time.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"While the asynchronous code is running,"},{"type":"text","text":" "},{"text":"the caller waits for that code to finish","type":"text"},{"type":"text","text":" "},{"type":"text","text":"before moving on to run the next line of code."},{"text":" ","type":"text"},{"type":"text","text":"For example,"},{"type":"text","text":" "},{"text":"to fetch the first three photos from a gallery,","type":"text"},{"text":" ","type":"text"},{"text":"you could await three calls to the ","type":"text"},{"code":"downloadPhoto(named:)","type":"codeVoice"},{"text":" function","type":"text"},{"type":"text","text":" "},{"text":"as follows:","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["let firstPhoto = await downloadPhoto(named: photoNames[0])","let secondPhoto = await downloadPhoto(named: photoNames[1])","let thirdPhoto = await downloadPhoto(named: photoNames[2])","","let photos = [firstPhoto, secondPhoto, thirdPhoto]","show(photos)"]},{"type":"paragraph","inlineContent":[{"text":"This approach has an important drawback:","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"Although the download is asynchronous"},{"type":"text","text":" "},{"text":"and lets other work happen while it progresses,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"only one call to "},{"code":"downloadPhoto(named:)","type":"codeVoice"},{"text":" runs at a time.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"Each photo downloads completely before the next one starts downloading."},{"type":"text","text":" "},{"text":"However, there’s no need for these operations to wait —","type":"text"},{"type":"text","text":" "},{"type":"text","text":"each photo can download independently, or even at the same time."}]},{"type":"paragraph","inlineContent":[{"text":"To call an asynchronous function","type":"text"},{"type":"text","text":" "},{"type":"text","text":"and let it run in parallel with code around it,"},{"type":"text","text":" "},{"text":"write ","type":"text"},{"type":"codeVoice","code":"async"},{"type":"text","text":" in front of "},{"code":"let","type":"codeVoice"},{"type":"text","text":" when you define a constant,"},{"type":"text","text":" "},{"type":"text","text":"and then write "},{"type":"codeVoice","code":"await"},{"text":" each time you use the constant.","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["async let firstPhoto = downloadPhoto(named: photoNames[0])","async let secondPhoto = downloadPhoto(named: photoNames[1])","async let thirdPhoto = downloadPhoto(named: photoNames[2])","","let photos = await [firstPhoto, secondPhoto, thirdPhoto]","show(photos)"]},{"inlineContent":[{"text":"In this example,","type":"text"},{"text":" ","type":"text"},{"text":"all three calls to ","type":"text"},{"code":"downloadPhoto(named:)","type":"codeVoice"},{"type":"text","text":" start"},{"text":" ","type":"text"},{"text":"without waiting for the previous one to complete.","type":"text"},{"text":" ","type":"text"},{"text":"If there are enough system resources available, they can run at the same time.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"None of these function calls are marked with "},{"type":"codeVoice","code":"await"},{"text":" ","type":"text"},{"text":"because the code doesn’t suspend to wait for the function’s result.","type":"text"},{"type":"text","text":" "},{"text":"Instead, execution continues","type":"text"},{"type":"text","text":" "},{"type":"text","text":"until the line where "},{"code":"photos","type":"codeVoice"},{"type":"text","text":" is defined —"},{"type":"text","text":" "},{"type":"text","text":"at that point, the program needs the results from these asynchronous calls,"},{"text":" ","type":"text"},{"type":"text","text":"so you write "},{"type":"codeVoice","code":"await"},{"type":"text","text":" to pause execution"},{"text":" ","type":"text"},{"type":"text","text":"until all three photos finish downloading."}],"type":"paragraph"},{"inlineContent":[{"text":"Here’s how you can think about the differences between these two approaches:","type":"text"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"Call asynchronous functions with ","type":"text"},{"type":"codeVoice","code":"await"},{"type":"text","text":" "},{"text":"when the code on the following lines depends on that function’s result.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"This creates work that is carried out sequentially."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Call asynchronous functions with "},{"code":"async","type":"codeVoice"},{"type":"text","text":"-"},{"type":"codeVoice","code":"let"},{"text":" ","type":"text"},{"type":"text","text":"when you don’t need the result until later in your code."},{"type":"text","text":" "},{"type":"text","text":"This creates work that can be carried out in parallel."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Both "},{"type":"codeVoice","code":"await"},{"text":" and ","type":"text"},{"type":"codeVoice","code":"async"},{"type":"text","text":"-"},{"code":"let","type":"codeVoice"},{"type":"text","text":" "},{"type":"text","text":"allow other code to run while they’re suspended."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"In both cases, you mark the possible suspension point with "},{"type":"codeVoice","code":"await"},{"text":" ","type":"text"},{"text":"to indicate that execution will pause, if needed,","type":"text"},{"type":"text","text":" "},{"text":"until an asynchronous function has returned.","type":"text"}],"type":"paragraph"}]}]},{"inlineContent":[{"text":"You can also mix both of these approaches in the same code.","type":"text"}],"type":"paragraph"},{"type":"heading","anchor":"Tasks-and-Task-Groups","level":2,"text":"Tasks and Task Groups"},{"inlineContent":[{"text":"A ","type":"text"},{"inlineContent":[{"text":"task","type":"text"}],"type":"emphasis"},{"type":"text","text":" is a unit of work"},{"type":"text","text":" "},{"type":"text","text":"that can be run asynchronously as part of your program."},{"text":" ","type":"text"},{"type":"text","text":"All asynchronous code runs as part of some task."},{"text":" ","type":"text"},{"text":"A task itself does only one thing at a time,","type":"text"},{"type":"text","text":" "},{"text":"but when you create multiple tasks,","type":"text"},{"text":" ","type":"text"},{"text":"Swift can schedule them to run simultaneously.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"The ","type":"text"},{"type":"codeVoice","code":"async"},{"text":"-","type":"text"},{"type":"codeVoice","code":"let"},{"type":"text","text":" syntax described in the previous section"},{"type":"text","text":" "},{"text":"implicitly creates a child task —","type":"text"},{"type":"text","text":" "},{"type":"text","text":"this syntax works well when you already know"},{"type":"text","text":" "},{"type":"text","text":"what tasks your program needs to run."},{"type":"text","text":" "},{"type":"text","text":"You can also create a task group"},{"type":"text","text":" "},{"type":"text","text":"(an instance of "},{"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/taskgroup","type":"reference","isActive":true},{"type":"text","text":")"},{"text":" ","type":"text"},{"text":"and explicitly add child tasks to that group,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"which gives you more control over priority and cancellation,"},{"text":" ","type":"text"},{"type":"text","text":"and lets you create a dynamic number of tasks."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"Tasks are arranged in a hierarchy.","type":"text"},{"text":" ","type":"text"},{"text":"Each task in a given task group has the same parent task,","type":"text"},{"type":"text","text":" "},{"text":"and each task can have child tasks.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"Because of the explicit relationship between tasks and task groups,"},{"type":"text","text":" "},{"type":"text","text":"this approach is called "},{"inlineContent":[{"type":"text","text":"structured concurrency"}],"type":"emphasis"},{"text":".","type":"text"},{"type":"text","text":" "},{"text":"The explicit parent-child relationships between tasks has several advantages:","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"In a parent task,"},{"text":" ","type":"text"},{"text":"you can’t forget to wait for its child tasks to complete.","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"When setting a higher priority on a child task,"},{"type":"text","text":" "},{"type":"text","text":"the parent task’s priority is automatically escalated."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"When a parent task is canceled,"},{"type":"text","text":" "},{"type":"text","text":"each of its child tasks is also automatically canceled."}]}]},{"content":[{"inlineContent":[{"text":"Task-local values propagate to child tasks efficiently and automatically.","type":"text"}],"type":"paragraph"}]}]},{"type":"paragraph","inlineContent":[{"text":"Here’s another version of the code to download photos","type":"text"},{"type":"text","text":" "},{"type":"text","text":"that handles any number of photos:"}]},{"type":"codeListing","syntax":"swift","code":["await withTaskGroup(of: Data.self) { group in","    let photoNames = await listPhotos(inGallery: \"Summer Vacation\")","    for name in photoNames {","        group.addTask {","            return await downloadPhoto(named: name)","        }","    }","","    for await photo in group {","        show(photo)","    }","}"]},{"type":"paragraph","inlineContent":[{"text":"The code above creates a new task group,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"and then creates child tasks"},{"text":" ","type":"text"},{"text":"to download each photo in the gallery.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"Swift runs as many of these tasks concurrently as conditions allow."},{"text":" ","type":"text"},{"type":"text","text":"As soon a child task finishes downloading a photo,"},{"text":" ","type":"text"},{"type":"text","text":"that photo is displayed."},{"text":" ","type":"text"},{"type":"text","text":"There’s no guarantee about the order that child tasks complete,"},{"text":" ","type":"text"},{"text":"so the photos from this gallery can be shown in any order.","type":"text"}]},{"type":"aside","name":"Note","style":"note","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":""},{"text":" ","type":"text"},{"type":"text","text":"If the code to download a photo could throw an error,"},{"text":" ","type":"text"},{"type":"text","text":"you would call "},{"type":"codeVoice","code":"withThrowingTaskGroup(of:returning:body:)"},{"text":" instead.","type":"text"}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"In the code listing above,"},{"type":"text","text":" "},{"text":"each photo is downloaded and then displayed,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"so the task group doesn’t return any results."},{"text":" ","type":"text"},{"type":"text","text":"For a task group that returns a result,"},{"text":" ","type":"text"},{"text":"you add code that accumulates its result","type":"text"},{"text":" ","type":"text"},{"text":"inside the closure you pass to ","type":"text"},{"type":"codeVoice","code":"withTaskGroup(of:returning:body:)"},{"type":"text","text":"."}]},{"syntax":"swift","code":["let photos = await withTaskGroup(of: Data.self) { group in","    let photoNames = await listPhotos(inGallery: \"Summer Vacation\")","    for name in photoNames {","        group.addTask {","            return await downloadPhoto(named: name)","        }","    }","","    var results: [Data] = []","    for await photo in group {","        results.append(photo)","    }","","    return results","}"],"type":"codeListing"},{"type":"paragraph","inlineContent":[{"text":"Like the previous example,","type":"text"},{"type":"text","text":" "},{"text":"this example creates a child task for each photo to download it.","type":"text"},{"type":"text","text":" "},{"text":"Unlike the previous example,","type":"text"},{"text":" ","type":"text"},{"text":"the ","type":"text"},{"code":"for","type":"codeVoice"},{"text":"-","type":"text"},{"type":"codeVoice","code":"await"},{"text":"-","type":"text"},{"code":"in","type":"codeVoice"},{"type":"text","text":" loop waits for the next child task to finish,"},{"text":" ","type":"text"},{"type":"text","text":"appends the result of that task to the array of results,"},{"type":"text","text":" "},{"type":"text","text":"and then continues waiting until all child tasks have finished."},{"type":"text","text":" "},{"type":"text","text":"Finally,"},{"text":" ","type":"text"},{"type":"text","text":"the task group returns the array of downloaded photos"},{"type":"text","text":" "},{"type":"text","text":"as its overall result."}]},{"text":"Task Cancellation","anchor":"Task-Cancellation","level":3,"type":"heading"},{"inlineContent":[{"text":"Swift concurrency uses a cooperative cancellation model.","type":"text"},{"text":" ","type":"text"},{"text":"Each task checks whether it has been canceled","type":"text"},{"type":"text","text":" "},{"text":"at the appropriate points in its execution,","type":"text"},{"text":" ","type":"text"},{"text":"and responds to cancellation appropriately.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"Depending on what work the task is doing,"},{"type":"text","text":" "},{"type":"text","text":"responding to cancellation usually means one of the following:"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Throwing an error like "},{"code":"CancellationError","type":"codeVoice"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Returning "},{"code":"nil","type":"codeVoice"},{"type":"text","text":" or an empty collection"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Returning the partially completed work","type":"text"}]}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Downloading pictures could take a long time"},{"type":"text","text":" "},{"text":"if the pictures are large or the network is slow.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"To let the user stop this work,"},{"type":"text","text":" "},{"type":"text","text":"without waiting for all of the tasks to complete,"},{"type":"text","text":" "},{"text":"the tasks need check for cancellation and stop running if they are canceled.","type":"text"},{"type":"text","text":" "},{"text":"There are two ways a task can do this:","type":"text"},{"text":" ","type":"text"},{"text":"by calling the ","type":"text"},{"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3814826-checkcancellation","isActive":true},{"text":" type method,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"or by reading the "},{"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/iscancelled-swift.type.property","isActive":true},{"text":" type property.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"Calling "},{"code":"checkCancellation()","type":"codeVoice"},{"text":" throws an error if the task is canceled;","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"a throwing task can propagate the error out of the task,"},{"type":"text","text":" "},{"text":"stopping all of the task’s work.","type":"text"},{"text":" ","type":"text"},{"text":"This has the advantage of being simple to implement and understand.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"For more flexibility, use the "},{"code":"isCancelled","type":"codeVoice"},{"text":" property,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"which lets you perform clean-up work as part of stopping the task,"},{"type":"text","text":" "},{"type":"text","text":"like closing network connections and deleting temporary files."}]},{"code":["let photos = await withTaskGroup(of: Optional<Data>.self) { group in","    let photoNames = await listPhotos(inGallery: \"Summer Vacation\")","    for name in photoNames {","        let added = group.addTaskUnlessCancelled {","            guard !Task.isCancelled else { return nil }","            return await downloadPhoto(named: name)","        }","        guard added else { break }","    }","","    var results: [Data] = []","    for await photo in group {","        if let photo { results.append(photo) }","    }","    return results","}"],"type":"codeListing","syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The code above makes several changes from the previous version:"}]},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"Each task is added using the"},{"type":"text","text":" "},{"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/taskgroup\/addtaskunlesscancelled(priority:operation:)","type":"reference","isActive":true},{"text":" method,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"to avoid starting new work after cancellation."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"After each call to ","type":"text"},{"code":"addTaskUnlessCancelled(priority:operation:)","type":"codeVoice"},{"text":",","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"the code confirms that the new child task was added."},{"text":" ","type":"text"},{"text":"If the group is canceled, the value of ","type":"text"},{"code":"added","type":"codeVoice"},{"type":"text","text":" is "},{"code":"false","type":"codeVoice"},{"text":" —","type":"text"},{"type":"text","text":" "},{"type":"text","text":"in that case, the code stops trying to download additional photos."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Each task checks for cancellation"},{"type":"text","text":" "},{"text":"before starting to download the photo.","type":"text"},{"type":"text","text":" "},{"text":"If it has been canceled, the task returns ","type":"text"},{"type":"codeVoice","code":"nil"},{"type":"text","text":"."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"At the end,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"the task group skips "},{"code":"nil","type":"codeVoice"},{"type":"text","text":" values when collecting the results."},{"type":"text","text":" "},{"type":"text","text":"Handling cancellation by returning "},{"type":"codeVoice","code":"nil"},{"type":"text","text":" "},{"type":"text","text":"means the task group can return a partial result —"},{"type":"text","text":" "},{"type":"text","text":"the photos that were already downloaded at the time of cancellation —"},{"type":"text","text":" "},{"text":"instead of discarding that completed work.","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"},{"type":"aside","style":"note","content":[{"inlineContent":[{"type":"text","text":""},{"text":" ","type":"text"},{"text":"To check whether a task has been canceled from outside that task,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"use the "},{"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/iscancelled-swift.property","isActive":true},{"text":" instance property","type":"text"},{"text":" ","type":"text"},{"text":"instead of the type property.","type":"text"}],"type":"paragraph"}],"name":"Note"},{"inlineContent":[{"text":"For work that needs immediate notification of cancellation,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"use the "},{"isActive":true,"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/swift\/withtaskcancellationhandler(operation:oncancel:)"},{"text":" method.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"For example:"}],"type":"paragraph"},{"type":"codeListing","code":["let task = await Task.withTaskCancellationHandler {","    \/\/ ...","} onCancel: {","    print(\"Canceled!\")","}","","\/\/ ... some time later...","task.cancel()  \/\/ Prints \"Canceled!\""],"syntax":"swift"},{"type":"paragraph","inlineContent":[{"text":"When using a cancellation handler,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"task cancellation is still cooperative:"},{"text":" ","type":"text"},{"type":"text","text":"The task either runs to completion"},{"text":" ","type":"text"},{"type":"text","text":"or checks for cancellation and stops early."},{"type":"text","text":" "},{"text":"Because the task is still running when the cancellation handler starts,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"avoid sharing state between the task and its cancellation handler,"},{"type":"text","text":" "},{"text":"which could create a race condition.","type":"text"}]},{"anchor":"Unstructured-Concurrency","level":3,"text":"Unstructured Concurrency","type":"heading"},{"inlineContent":[{"text":"In addition to the structured approaches to concurrency","type":"text"},{"text":" ","type":"text"},{"text":"described in the previous sections,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"Swift also supports unstructured concurrency."},{"type":"text","text":" "},{"type":"text","text":"Unlike tasks that are part of a task group,"},{"text":" ","type":"text"},{"text":"an ","type":"text"},{"inlineContent":[{"type":"text","text":"unstructured task"}],"type":"emphasis"},{"text":" doesn’t have a parent task.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"You have complete flexibility to manage unstructured tasks"},{"text":" ","type":"text"},{"type":"text","text":"in whatever way your program needs,"},{"type":"text","text":" "},{"type":"text","text":"but you’re also completely responsible for their correctness."},{"type":"text","text":" "},{"type":"text","text":"To create an unstructured task that runs on the current actor,"},{"text":" ","type":"text"},{"text":"call the ","type":"text"},{"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3856790-init","isActive":true,"type":"reference"},{"type":"text","text":" initializer."},{"text":" ","type":"text"},{"text":"To create an unstructured task that’s not part of the current actor,","type":"text"},{"text":" ","type":"text"},{"text":"known more specifically as a ","type":"text"},{"inlineContent":[{"type":"text","text":"detached task"}],"type":"emphasis"},{"type":"text","text":","},{"type":"text","text":" "},{"type":"text","text":"call the "},{"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3856786-detached","isActive":true,"type":"reference"},{"type":"text","text":" class method."},{"text":" ","type":"text"},{"type":"text","text":"Both of these operations return a task that you can interact with —"},{"type":"text","text":" "},{"text":"for example, to wait for its result or to cancel it.","type":"text"}],"type":"paragraph"},{"syntax":"swift","code":["let newPhoto = \/\/ ... some photo data ...","let handle = Task {","    return await add(newPhoto, toGalleryNamed: \"Spring Adventures\")","}","let result = await handle.value"],"type":"codeListing"},{"inlineContent":[{"text":"For more information about managing detached tasks,","type":"text"},{"type":"text","text":" "},{"text":"see ","type":"text"},{"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task","isActive":true},{"type":"text","text":"."}],"type":"paragraph"},{"level":2,"type":"heading","anchor":"Actors","text":"Actors"},{"inlineContent":[{"text":"You can use tasks to break up your program into isolated, concurrent pieces.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"Tasks are isolated from each other,"},{"type":"text","text":" "},{"text":"which is what makes it safe for them to run at the same time,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"but sometimes you need to share some information between tasks."},{"text":" ","type":"text"},{"text":"Actors let you safely share information between concurrent code.","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Like classes, actors are reference types,"},{"text":" ","type":"text"},{"type":"text","text":"so the comparison of value types and reference types"},{"type":"text","text":" "},{"text":"in ","type":"text"},{"identifier":"doc:\/\/org.swift.tspl\/documentation\/The-Swift-Programming-Language\/ClassesAndStructures#Classes-Are-Reference-Types","isActive":true,"type":"reference"},{"type":"text","text":" "},{"text":"applies to actors as well as classes.","type":"text"},{"text":" ","type":"text"},{"text":"Unlike classes,","type":"text"},{"type":"text","text":" "},{"text":"actors allow only one task to access their mutable state at a time,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"which makes it safe for code in multiple tasks"},{"type":"text","text":" "},{"type":"text","text":"to interact with the same instance of an actor."},{"text":" ","type":"text"},{"type":"text","text":"For example, here’s an actor that records temperatures:"}]},{"code":["actor TemperatureLogger {","    let label: String","    var measurements: [Int]","    private(set) var max: Int","","    init(label: String, measurement: Int) {","        self.label = label","        self.measurements = [measurement]","        self.max = measurement","    }","}"],"type":"codeListing","syntax":"swift"},{"type":"paragraph","inlineContent":[{"text":"You introduce an actor with the ","type":"text"},{"code":"actor","type":"codeVoice"},{"type":"text","text":" keyword,"},{"type":"text","text":" "},{"type":"text","text":"followed by its definition in a pair of braces."},{"type":"text","text":" "},{"type":"text","text":"The "},{"type":"codeVoice","code":"TemperatureLogger"},{"type":"text","text":" actor has properties"},{"type":"text","text":" "},{"text":"that other code outside the actor can access,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"and restricts the "},{"type":"codeVoice","code":"max"},{"text":" property so only code inside the actor","type":"text"},{"type":"text","text":" "},{"text":"can update the maximum value.","type":"text"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"You create an instance of an actor"},{"text":" ","type":"text"},{"text":"using the same initializer syntax as structures and classes.","type":"text"},{"type":"text","text":" "},{"text":"When you access a property or method of an actor,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"you use "},{"type":"codeVoice","code":"await"},{"type":"text","text":" to mark the potential suspension point."},{"type":"text","text":" "},{"type":"text","text":"For example:"}]},{"syntax":"swift","code":["let logger = TemperatureLogger(label: \"Outdoors\", measurement: 25)","print(await logger.max)","\/\/ Prints \"25\""],"type":"codeListing"},{"inlineContent":[{"text":"In this example,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"accessing "},{"type":"codeVoice","code":"logger.max"},{"text":" is a possible suspension point.","type":"text"},{"text":" ","type":"text"},{"text":"Because the actor allows only one task at a time to access its mutable state,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"if code from another task is already interacting with the logger,"},{"type":"text","text":" "},{"text":"this code suspends while it waits to access the property.","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"In contrast,"},{"type":"text","text":" "},{"text":"code that’s part of the actor doesn’t write ","type":"text"},{"type":"codeVoice","code":"await"},{"type":"text","text":" "},{"type":"text","text":"when accessing the actor’s properties."},{"text":" ","type":"text"},{"type":"text","text":"For example,"},{"type":"text","text":" "},{"text":"here’s a method that updates a ","type":"text"},{"code":"TemperatureLogger","type":"codeVoice"},{"type":"text","text":" with a new temperature:"}]},{"syntax":"swift","code":["extension TemperatureLogger {","    func update(with measurement: Int) {","        measurements.append(measurement)","        if measurement > max {","            max = measurement","        }","    }","}"],"type":"codeListing"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The "},{"code":"update(with:)","type":"codeVoice"},{"type":"text","text":" method is already running on the actor,"},{"type":"text","text":" "},{"type":"text","text":"so it doesn’t mark its access to properties like "},{"type":"codeVoice","code":"max"},{"type":"text","text":" with "},{"code":"await","type":"codeVoice"},{"type":"text","text":"."},{"type":"text","text":" "},{"type":"text","text":"This method also shows one of the reasons"},{"text":" ","type":"text"},{"type":"text","text":"why actors allow only one task at a time to interact with their mutable state:"},{"type":"text","text":" "},{"text":"Some updates to an actor’s state temporarily break invariants.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"The "},{"code":"TemperatureLogger","type":"codeVoice"},{"type":"text","text":" actor keeps track of"},{"type":"text","text":" "},{"text":"a list of temperatures and a maximum temperature,","type":"text"},{"type":"text","text":" "},{"text":"and it updates the maximum temperature when you record a new measurement.","type":"text"},{"text":" ","type":"text"},{"text":"In the middle of an update,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"after appending the new measurement but before updating "},{"type":"codeVoice","code":"max"},{"text":",","type":"text"},{"type":"text","text":" "},{"type":"text","text":"the temperature logger is in a temporary inconsistent state."},{"text":" ","type":"text"},{"type":"text","text":"Preventing multiple tasks from interacting with the same instance simultaneously"},{"text":" ","type":"text"},{"type":"text","text":"prevents problems like the following sequence of events:"}]},{"type":"orderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Your code calls the "},{"type":"codeVoice","code":"update(with:)"},{"text":" method.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"It updates the "},{"code":"measurements","type":"codeVoice"},{"type":"text","text":" array first."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Before your code can update "},{"type":"codeVoice","code":"max"},{"type":"text","text":","},{"text":" ","type":"text"},{"type":"text","text":"code elsewhere reads the maximum value and the array of temperatures."}]}]},{"content":[{"inlineContent":[{"text":"Your code finishes its update by changing ","type":"text"},{"code":"max","type":"codeVoice"},{"type":"text","text":"."}],"type":"paragraph"}]}]},{"type":"paragraph","inlineContent":[{"text":"In this case,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"the code running elsewhere would read incorrect information"},{"type":"text","text":" "},{"text":"because its access to the actor was interleaved","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"in the middle of the call to "},{"code":"update(with:)","type":"codeVoice"},{"text":" ","type":"text"},{"type":"text","text":"while the data was temporarily invalid."},{"text":" ","type":"text"},{"type":"text","text":"You can prevent this problem when using Swift actors"},{"text":" ","type":"text"},{"type":"text","text":"because they only allow one operation on their state at a time,"},{"type":"text","text":" "},{"type":"text","text":"and because that code can be interrupted"},{"text":" ","type":"text"},{"text":"only in places where ","type":"text"},{"code":"await","type":"codeVoice"},{"type":"text","text":" marks a suspension point."},{"text":" ","type":"text"},{"type":"text","text":"Because "},{"code":"update(with:)","type":"codeVoice"},{"type":"text","text":" doesn’t contain any suspension points,"},{"type":"text","text":" "},{"type":"text","text":"no other code can access the data in the middle of an update."}]},{"inlineContent":[{"type":"text","text":"If code outside the actor tries to access those properties directly,"},{"type":"text","text":" "},{"text":"like accessing a structure or class’s properties,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"you’ll get a compile-time error."},{"text":" ","type":"text"},{"text":"For example:","type":"text"}],"type":"paragraph"},{"type":"codeListing","syntax":"swift","code":["print(logger.max)  \/\/ Error"]},{"inlineContent":[{"text":"Accessing ","type":"text"},{"code":"logger.max","type":"codeVoice"},{"text":" without writing ","type":"text"},{"code":"await","type":"codeVoice"},{"type":"text","text":" fails because"},{"type":"text","text":" "},{"type":"text","text":"the properties of an actor are part of that actor’s isolated local state."},{"text":" ","type":"text"},{"text":"The code to access this property needs to run as part of the actor,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"which is an asynchronous operation and requires writing "},{"code":"await","type":"codeVoice"},{"text":".","type":"text"},{"type":"text","text":" "},{"type":"text","text":"Swift guarantees that"},{"text":" ","type":"text"},{"type":"text","text":"only code running on an actor can access that actor’s local state."},{"type":"text","text":" "},{"text":"This guarantee is known as ","type":"text"},{"inlineContent":[{"text":"actor isolation","type":"text"}],"type":"emphasis"},{"text":".","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"The following aspects of the Swift concurrency model","type":"text"},{"type":"text","text":" "},{"text":"work together to make it easier to reason about shared mutable state:","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Code in between possible suspension points runs sequentially,"},{"type":"text","text":" "},{"type":"text","text":"without the possibility of interruption from other concurrent code."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Code that interacts with an actor’s local state","type":"text"},{"text":" ","type":"text"},{"text":"runs only on that actor.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"An actor runs only one piece of code at a time."}],"type":"paragraph"}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Because of these guarantees,"},{"text":" ","type":"text"},{"text":"code that doesn’t include ","type":"text"},{"type":"codeVoice","code":"await"},{"type":"text","text":" and that’s inside an actor"},{"type":"text","text":" "},{"text":"can make the updates without a risk of other places in your program","type":"text"},{"type":"text","text":" "},{"type":"text","text":"observing the temporarily invalid state."},{"type":"text","text":" "},{"type":"text","text":"For example,"},{"text":" ","type":"text"},{"text":"the code below converts measured temperatures from Fahrenheit to Celsius:","type":"text"}]},{"syntax":"swift","code":["extension TemperatureLogger {","    func convertFahrenheitToCelsius() {","        measurements = measurements.map { measurement in","            (measurement - 32) * 5 \/ 9","        }","    }","}"],"type":"codeListing"},{"type":"paragraph","inlineContent":[{"text":"The code above converts the array of measurements, one at a time.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"While the map operation is in progress,"},{"text":" ","type":"text"},{"type":"text","text":"some temperatures are in Fahrenheit and others are in Celsius."},{"type":"text","text":" "},{"type":"text","text":"However, because none of the code includes "},{"type":"codeVoice","code":"await"},{"text":",","type":"text"},{"type":"text","text":" "},{"type":"text","text":"there are no potential suspension points in this method."},{"text":" ","type":"text"},{"type":"text","text":"The state that this method modifies belongs to the actor,"},{"text":" ","type":"text"},{"type":"text","text":"which protects it against code reading or modifying it"},{"type":"text","text":" "},{"text":"except when that code runs on the actor.","type":"text"},{"type":"text","text":" "},{"text":"This means there’s no way for other code","type":"text"},{"text":" ","type":"text"},{"text":"to read a list of partially converted temperatures","type":"text"},{"type":"text","text":" "},{"type":"text","text":"while unit conversion is in progress."}]},{"type":"paragraph","inlineContent":[{"text":"In addition to writing code in an actor","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"that protects temporary invalid state by omitting potential suspension points,"},{"type":"text","text":" "},{"type":"text","text":"you can move that code into a synchronous method."},{"text":" ","type":"text"},{"text":"The ","type":"text"},{"code":"convertFahrenheitToCelsius()","type":"codeVoice"},{"text":" method above is a synchronous method,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"so it’s guaranteed to "},{"type":"emphasis","inlineContent":[{"type":"text","text":"never"}]},{"text":" contain potential suspension points.","type":"text"},{"text":" ","type":"text"},{"text":"This function encapsulates the code","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"that temporarily makes the data model inconsistent,"},{"type":"text","text":" "},{"type":"text","text":"and makes it easier for anyone reading the code"},{"text":" ","type":"text"},{"text":"to recognize that no other code can run","type":"text"},{"type":"text","text":" "},{"text":"before data consistency is restored by completing the work.","type":"text"},{"type":"text","text":" "},{"text":"In the future,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"if you try to add concurrent code to this function,"},{"type":"text","text":" "},{"type":"text","text":"introducing a possible suspension point,"},{"type":"text","text":" "},{"type":"text","text":"you’ll get compile-time error instead of introducing a bug."}]},{"text":"Sendable Types","anchor":"Sendable-Types","level":2,"type":"heading"},{"inlineContent":[{"type":"text","text":"Tasks and actors let you divide a program"},{"text":" ","type":"text"},{"type":"text","text":"into pieces that can safely run concurrently."},{"text":" ","type":"text"},{"text":"Inside of a task or an instance of an actor,","type":"text"},{"type":"text","text":" "},{"text":"the part of a program that contains mutable state,","type":"text"},{"type":"text","text":" "},{"text":"like variables and properties,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"is called a "},{"inlineContent":[{"type":"text","text":"concurrency domain"}],"type":"emphasis"},{"text":".","type":"text"},{"type":"text","text":" "},{"type":"text","text":"Some kinds of data can’t be shared between concurrency domains,"},{"type":"text","text":" "},{"type":"text","text":"because that data contains mutable state,"},{"type":"text","text":" "},{"type":"text","text":"but it doesn’t protect against overlapping access."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"A type that can be shared from one concurrency domain to another"},{"type":"text","text":" "},{"text":"is known as a ","type":"text"},{"type":"emphasis","inlineContent":[{"type":"text","text":"sendable"}]},{"type":"text","text":" type."},{"text":" ","type":"text"},{"text":"For example, it can be passed as an argument when calling an actor method","type":"text"},{"type":"text","text":" "},{"text":"or be returned as the result of a task.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"The examples earlier in this chapter didn’t discuss sendability"},{"type":"text","text":" "},{"type":"text","text":"because those examples use simple value types"},{"type":"text","text":" "},{"type":"text","text":"that are always safe to share"},{"text":" ","type":"text"},{"text":"for the data being passed between concurrency domains.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"In contrast,"},{"text":" ","type":"text"},{"text":"some types aren’t safe to pass across concurrency domains.","type":"text"},{"type":"text","text":" "},{"text":"For example, a class that contains mutable properties","type":"text"},{"type":"text","text":" "},{"text":"and doesn’t serialize access to those properties","type":"text"},{"text":" ","type":"text"},{"text":"can produce unpredictable and incorrect results","type":"text"},{"type":"text","text":" "},{"text":"when you pass instances of that class between different tasks.","type":"text"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"You mark a type as being sendable"},{"text":" ","type":"text"},{"type":"text","text":"by declaring conformance to the "},{"code":"Sendable","type":"codeVoice"},{"type":"text","text":" protocol."},{"type":"text","text":" "},{"text":"That protocol doesn’t have any code requirements,","type":"text"},{"text":" ","type":"text"},{"text":"but it does have semantic requirements that Swift enforces.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"In general, there are three ways for a type to be sendable:"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"The type is a value type,"},{"type":"text","text":" "},{"type":"text","text":"and its mutable state is made up of other sendable data —"},{"type":"text","text":" "},{"type":"text","text":"for example, a structure with stored properties that are sendable"},{"type":"text","text":" "},{"type":"text","text":"or an enumeration with associated values that are sendable."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"The type doesn’t have any mutable state,"},{"type":"text","text":" "},{"type":"text","text":"and its immutable state is made up of other sendable data —"},{"type":"text","text":" "},{"text":"for example, a structure or class that has only read-only properties.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"The type has code that ensures the safety of its mutable state,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"like a class that’s marked "},{"type":"codeVoice","code":"@MainActor"},{"type":"text","text":" "},{"text":"or a class that serializes access to its properties","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"on a particular thread or queue."}]}]}]},{"inlineContent":[{"text":"For a detailed list of the semantic requirements,","type":"text"},{"text":" ","type":"text"},{"text":"see the ","type":"text"},{"identifier":"https:\/\/developer.apple.com\/documentation\/swift\/sendable","type":"reference","isActive":true},{"type":"text","text":" protocol reference."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"Some types are always sendable,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"like structures that have only sendable properties"},{"type":"text","text":" "},{"type":"text","text":"and enumerations that have only sendable associated values."},{"text":" ","type":"text"},{"type":"text","text":"For example:"}]},{"syntax":"swift","code":["struct TemperatureReading: Sendable {","    var measurement: Int","}","","extension TemperatureLogger {","    func addReading(from reading: TemperatureReading) {","        measurements.append(reading.measurement)","    }","}","","let logger = TemperatureLogger(label: \"Tea kettle\", measurement: 85)","let reading = TemperatureReading(measurement: 45)","await logger.addReading(from: reading)"],"type":"codeListing"},{"inlineContent":[{"text":"Because ","type":"text"},{"type":"codeVoice","code":"TemperatureReading"},{"text":" is a structure that has only sendable properties,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"and the structure isn’t marked "},{"code":"public","type":"codeVoice"},{"type":"text","text":" or "},{"code":"@usableFromInline","type":"codeVoice"},{"type":"text","text":","},{"type":"text","text":" "},{"type":"text","text":"it’s implicitly sendable."},{"type":"text","text":" "},{"type":"text","text":"Here’s a version of the structure"},{"type":"text","text":" "},{"text":"where conformance to the ","type":"text"},{"type":"codeVoice","code":"Sendable"},{"text":" protocol is implied:","type":"text"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["struct TemperatureReading {","    var measurement: Int","}"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"To explicitly mark a type as not being sendable,"},{"type":"text","text":" "},{"type":"text","text":"overriding an implicit conformance to the "},{"code":"Sendable","type":"codeVoice"},{"text":" protocol,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"use an extension:"}]},{"code":["struct FileDescriptor {","    let rawValue: CInt","}","","@available(*, unavailable)","extension FileDescriptor: Sendable { }"],"type":"codeListing","syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The code above shows part of a wrapper around POSIX file descriptors."},{"text":" ","type":"text"},{"text":"Even though interface for file descriptors uses integers","type":"text"},{"type":"text","text":" "},{"type":"text","text":"to identify and interact with open files,"},{"text":" ","type":"text"},{"type":"text","text":"and integer values are sendable,"},{"text":" ","type":"text"},{"type":"text","text":"a file descriptor isn’t safe to send across concurrency domains."}]},{"inlineContent":[{"text":"In the code above,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"the "},{"type":"codeVoice","code":"FileDescriptor"},{"type":"text","text":" is a structure"},{"type":"text","text":" "},{"text":"that meets the criteria to be implicitly sendable.","type":"text"},{"type":"text","text":" "},{"text":"However, the extension makes its conformance to ","type":"text"},{"code":"Sendable","type":"codeVoice"},{"type":"text","text":" unavailable,"},{"type":"text","text":" "},{"text":"preventing the type from being sendable.","type":"text"}],"type":"paragraph"},{"type":"aside","name":"Beta Software","content":[{"inlineContent":[{"text":"","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"This documentation contains preliminary information about an API or technology in development. This information is subject to change, and software implemented according to this documentation should be tested with final operating system software."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"Learn more about using ","type":"text"},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/support\/beta-software\/"},{"text":".","type":"text"}]}],"style":"note"}],"kind":"content"}],"hierarchy":{"paths":[["doc:\/\/org.swift.tspl\/documentation\/The-Swift-Programming-Language"]]},"sections":[],"metadata":{"title":"Concurrency"},"abstract":[{"text":"Perform asynchronous operations.","type":"text"}],"schemaVersion":{"patch":0,"major":0,"minor":3},"identifier":{"url":"doc:\/\/org.swift.tspl\/documentation\/The-Swift-Programming-Language\/Concurrency","interfaceLanguage":"swift"},"kind":"article","references":{"https://developer.apple.com/documentation/swift/task/3814826-checkcancellation":{"titleInlineContent":[{"code":"Task.checkCancellation()","type":"codeVoice"}],"title":"Task.checkCancellation()","url":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3814826-checkcancellation","type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3814826-checkcancellation"},"https://developer.apple.com/documentation/swift/task/sleep(for:tolerance:clock:)":{"titleInlineContent":[{"code":"Task.sleep(for:tolerance:clock:)","type":"codeVoice"}],"title":"Task.sleep(for:tolerance:clock:)","url":"https:\/\/developer.apple.com\/documentation\/swift\/task\/sleep(for:tolerance:clock:)","type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/sleep(for:tolerance:clock:)"},"doc://org.swift.tspl/documentation/The-Swift-Programming-Language/Concurrency#Unstructured-Concurrency":{"abstract":[],"kind":"section","title":"Unstructured Concurrency","url":"\/documentation\/the-swift-programming-language\/concurrency#Unstructured-Concurrency","type":"topic","identifier":"doc:\/\/org.swift.tspl\/documentation\/The-Swift-Programming-Language\/Concurrency#Unstructured-Concurrency"},"https://developer.apple.com/documentation/swift/taskgroup/addtaskunlesscancelled(priority:operation:)":{"titleInlineContent":[{"code":"TaskGroup.addTaskUnlessCancelled(priority:operation:)","type":"codeVoice"}],"title":"TaskGroup.addTaskUnlessCancelled(priority:operation:)","url":"https:\/\/developer.apple.com\/documentation\/swift\/taskgroup\/addtaskunlesscancelled(priority:operation:)","type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/swift\/taskgroup\/addtaskunlesscancelled(priority:operation:)"},"https://developer.apple.com/documentation/swift/withtaskcancellationhandler(operation:oncancel:)":{"titleInlineContent":[{"code":"Task.withTaskCancellationHandler(operation:onCancel:)","type":"codeVoice"}],"title":"Task.withTaskCancellationHandler(operation:onCancel:)","url":"https:\/\/developer.apple.com\/documentation\/swift\/withtaskcancellationhandler(operation:oncancel:)","type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/swift\/withtaskcancellationhandler(operation:oncancel:)"},"https://developer.apple.com/documentation/swift/asyncsequence":{"titleInlineContent":[{"code":"AsyncSequence","type":"codeVoice"}],"title":"AsyncSequence","url":"https:\/\/developer.apple.com\/documentation\/swift\/asyncsequence","type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/swift\/asyncsequence"},"https://developer.apple.com/documentation/swift/task/iscancelled-swift.property":{"titleInlineContent":[{"code":"Task.isCancelled","type":"codeVoice"}],"title":"Task.isCancelled","url":"https:\/\/developer.apple.com\/documentation\/swift\/task\/iscancelled-swift.property","type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/iscancelled-swift.property"},"https://developer.apple.com/documentation/swift/taskgroup":{"titleInlineContent":[{"code":"TaskGroup","type":"codeVoice"}],"title":"TaskGroup","url":"https:\/\/developer.apple.com\/documentation\/swift\/taskgroup","type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/swift\/taskgroup"},"https://developer.apple.com/support/beta-software/":{"titleInlineContent":[{"text":"Apple’s beta software","type":"text"}],"title":"Apple’s beta software","url":"https:\/\/developer.apple.com\/support\/beta-software\/","type":"link","identifier":"https:\/\/developer.apple.com\/support\/beta-software\/"},"https://developer.apple.com/documentation/swift/task/iscancelled-swift.type.property":{"titleInlineContent":[{"code":"Task.isCancelled","type":"codeVoice"}],"title":"Task.isCancelled","url":"https:\/\/developer.apple.com\/documentation\/swift\/task\/iscancelled-swift.type.property","type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/iscancelled-swift.type.property"},"doc://org.swift.tspl/documentation/The-Swift-Programming-Language/ClassesAndStructures#Classes-Are-Reference-Types":{"kind":"section","abstract":[],"identifier":"doc:\/\/org.swift.tspl\/documentation\/The-Swift-Programming-Language\/ClassesAndStructures#Classes-Are-Reference-Types","title":"Classes Are Reference Types","type":"topic","url":"\/documentation\/the-swift-programming-language\/classesandstructures#Classes-Are-Reference-Types"},"doc://org.swift.tspl/documentation/The-Swift-Programming-Language":{"title":"The Swift Programming Language (6.0 beta)","abstract":[],"type":"topic","identifier":"doc:\/\/org.swift.tspl\/documentation\/The-Swift-Programming-Language","url":"\/documentation\/the-swift-programming-language","role":"collection","kind":"article"},"https://developer.apple.com/documentation/swift/task/3814840-yield":{"titleInlineContent":[{"code":"Task.yield()","type":"codeVoice"}],"title":"Task.yield()","url":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3814840-yield","type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3814840-yield"},"https://developer.apple.com/documentation/swift/task/3856790-init":{"titleInlineContent":[{"code":"Task.init(priority:operation:)","type":"codeVoice"}],"title":"Task.init(priority:operation:)","url":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3856790-init","type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3856790-init"},"https://developer.apple.com/documentation/swift/sequence":{"titleInlineContent":[{"code":"Sequence","type":"codeVoice"}],"title":"Sequence","url":"https:\/\/developer.apple.com\/documentation\/swift\/sequence","type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/swift\/sequence"},"https://developer.apple.com/documentation/swift/task":{"titleInlineContent":[{"code":"Task","type":"codeVoice"}],"title":"Task","url":"https:\/\/developer.apple.com\/documentation\/swift\/task","type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task"},"https://developer.apple.com/documentation/swift/sendable":{"titleInlineContent":[{"code":"Sendable","type":"codeVoice"}],"title":"Sendable","url":"https:\/\/developer.apple.com\/documentation\/swift\/sendable","type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/swift\/sendable"},"https://developer.apple.com/documentation/swift/task/3856786-detached":{"titleInlineContent":[{"code":"Task.detached(priority:operation:)","type":"codeVoice"}],"title":"Task.detached(priority:operation:)","url":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3856786-detached","type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/swift\/task\/3856786-detached"}}}